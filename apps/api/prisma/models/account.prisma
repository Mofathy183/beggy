/// Authentication account associated with a user.
///
/// Represents a single authentication method such as:
/// - LOCAL (email/password)
/// - GOOGLE
/// - FACEBOOK
///
/// A user may have multiple accounts, one per provider.
model Account {
    /// Primary identifier for the account.
    id String @id @default(uuid())

    /// Authentication provider type.
    authProvider AuthProvider

    /// External provider identifier (OAuth only).
    /// Null for LOCAL authentication.
    providerId String? @map("provider_id")

    /// Hashed password for LOCAL authentication.
    /// Always null for OAuth-based accounts.
    hashedPassword String?

    /// Timestamp of the last password change.
    /// Used for security checks and token invalidation.
    passwordChangeAt DateTime? @map("password_change_at")

    /// Identifier of the owning user.
    userId String @map("user_id")

    /// Relation to the owning user.
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    /// Account creation timestamp.
    createdAt DateTime @default(now()) @map("created_at")

    /// Account update timestamp.
    updatedAt DateTime @updatedAt @map("updated_at")

    /// Ensures that a user can have at most one account per authentication provider.
    /// 
    /// Examples:
    /// - A user may have one LOCAL account.
    /// - A user may have one GOOGLE account.
    /// - A user may NOT have two GOOGLE accounts.
    ///
    /// This enables account linking across providers while preventing duplicates.
    @@unique([userId, authProvider])
    /// Ensures that an external provider identity cannot be linked to multiple users.
    ///
    /// Provider identifiers (e.g. Google `sub`, Facebook `id`) are only guaranteed
    /// to be unique within the scope of their provider.
    ///
    /// This composite constraint prevents the same OAuth identity from being reused
    /// across different users while still allowing identical IDs from different providers.
    @@unique([authProvider, providerId])
    
    /// Database table name.
    @@map("accounts")
}
