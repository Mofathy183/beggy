/// Core user entity representing system identity and ownership.
///
/// Authentication and profile data are intentionally separated
/// into Account and Profile models.
model User {
    /// Primary user identifier.
    id String @id @default(uuid())

    /// Unique email address.
    email String @unique

    /// User role within the system.
    role Role @default(USER)

    /// Indicates whether the user is active.
    isActive Boolean @default(true) @map("is_active")

    /// Indicates whether the user's email is verified.
    isEmailVerified Boolean @default(false) @map("is_email_verified")

    /// User creation timestamp.
    createdAt DateTime @default(now()) @map("created_at")

    /// User update timestamp.
    updatedAt DateTime @updatedAt @map("updated_at")

    /// Authentication accounts (LOCAL, GOOGLE, FACEBOOK).
    account Account[]

    /// Optional user profile.
    profile Profile?

    /// User authentication tokens.
    userToken UserToken[]

    /// Domain-owned resources.
    bags      Bags[]
    suitcases Suitcases[]
    items     Items[]

    /// Database table name.
    @@map("users")
}

model UserToken {
    id        String    @id @default(uuid())
    type      TokenType
    hashToken String    @unique
    expiresAt DateTime
    createdAt DateTime  @default(now()) @map("created_at")

    userId String
    user   User   @relation(fields: [userId], references: [id])

    @@map("user_tokens")
}

/// ------------------------------------------------------------
/// Permission
/// ------------------------------------------------------------
/// Represents a **single rule** defining what actions are allowed.
///
/// Examples:
/// - CREATE + OWN + BAG
/// - READ + ANY + USER
/// - MANAGE + ANY + PERMISSION
///
/// A permission belongs to many roles through RoleOnPermission.
///
/// Uniqueness rule:
/// Each combination (action, scope, subject) must be unique.
model Permission {
    /// Primary identifier
    id String @id @default(uuid())

    /// The action (CREATE/READ/UPDATE/DELETE/MANAGE)
    action Action

    /// Whether the permission applies to OWN or ANY resource
    scope Scope

    /// The resource type this permission applies to
    subject Subject

    /// Many-to-many relation: roles that have this permission
    rolePermissions RoleOnPermission[]

    @@unique([action, scope, subject])
    @@map("permissions")
}

/// ------------------------------------------------------------
/// RoleOnPermission (pivot / join table)
/// ------------------------------------------------------------
/// Connects a Role to a Permission (many-to-many).
///
/// Examples:
/// - ADMIN → many permissions
/// - MEMBER → a limited set of permissions
///
/// Enforces unique combinations to prevent duplicates.
model RoleOnPermission {
    /// Primary identifier
    id String @id @default(uuid())

    /// The role assigned in this mapping
    role Role

    /// The linked permission
    permission Permission @relation(fields: [permissionId], references: [id])

    /// Foreign key to Permission
    permissionId String

    @@unique([role, permissionId])
    @@map("role_on_permissions")
}
